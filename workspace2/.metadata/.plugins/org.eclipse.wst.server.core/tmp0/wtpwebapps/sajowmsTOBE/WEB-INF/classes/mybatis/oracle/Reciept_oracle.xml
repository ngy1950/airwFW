<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Reciept">


	<!-- RECDH 생성 VALDATION 체크 -->
	<select id="RECDH_VALDATION_MAP" parameterType="hashmap" resultType="DataMap">
		SELECT CASE WHEN TRIM(#{RECVKY}) IS NULL THEN 'VALID_M0560'
		            WHEN (SELECT COUNT(1) FROM OWNER WHERE OWNRKY = #{OWNRKY}) &lt; 1 THEN 'MASTER_B0016'
		            WHEN (SELECT COUNT(1) FROM WAHMA WHERE WAREKY = #{WAREKY}) &lt; 1 THEN 'VALID_M0561'
		            WHEN (SELECT COUNT(1) FROM DOCTM WHERE DOCUTY = #{RCPTTY}) &lt; 1 THEN 'VALID_M0562'
          			WHEN TRIM(#{DOCDAT}) IS NULL THEN 'IN_M0033'
          			WHEN TRIM(#{DPTNKY}) IS NULL THEN 'INV_M0064'
		            ELSE ''
		        END MSGKEY
		     , (SELECT DOCCAT FROM DOCTM WHERE DOCUTY = #{RCPTTY}) AS DOCCAT
		     , 1 as dummy
		  FROM DUAL
	</select>


	<!-- RECDH 생성  -->
	
	<insert id="RECDH_INSERT"  parameterType="hashmap">
		INSERT INTO RECDH
		( RECVKY, WAREKY, RCPTTY, STATDO, SAPSTS, DOCDAT, DOCCAT, DPTNKY, DRELIN, ARCPTD, OWNRKY, 
		  INDRCN, CRECVD, RSNCOD, PUTSTS, USRID1, UNAME1, DEPTID1, DNAME1, USRID2, UNAME2, DEPTID2, 
		  DNAME2, USRID3, UNAME3, DEPTID3, DNAME3, USRID4, UNAME4, DEPTID4, DNAME4, DOCTXT, CREDAT, 
		  CRETIM, CREUSR, LMODAT, LMOTIM, LMOUSR
		)
		VALUES
		( #{RECVKY}, #{WAREKY}, #{RCPTTY}, NVL(TRIM(#{STATDO}),'NEW'), NVL(TRIM(#{SAPSTS}), ' '), #{DOCDAT}, #{DOCCAT}, #{DPTNKY}, NVL(TRIM(#{DRELIN}), ' '), TO_CHAR(SYSDATE , 'YYYYMMDD'), #{OWNRKY}, 
		  NVL(TRIM(#{INDRCN}),' '), NVL(TRIM(#{CRECVD}), ' '), NVL(TRIM(#{RSNCOD}), ' '), NVL(TRIM(#{PUTSTS}), ' '), NVL(TRIM(#{USRID1}), ' '), NVL(TRIM(#{UNAME1}), ' '), NVL(TRIM(#{DEPTID1}), ' '), #{DNAME1}, NVL(TRIM(#{USRID2}), ' '), NVL(TRIM(#{UNAME2}), ' '), NVL(TRIM(#{DEPTID2}), ' '), 
		  NVL(TRIM(#{DNAME2}), ' '), NVL(TRIM(#{USRID3}), ' '), NVL(TRIM(#{UNAME3}), ' '), NVL(TRIM(#{DEPTID3}), ' '), NVL(TRIM(#{DNAME3}), ' '), NVL(TRIM(#{USRID4}), ' '), NVL(TRIM(#{UNAME4}), ' '), NVL(TRIM(#{DEPTID4}), ' '), #{DNAME4}, NVL(TRIM(#{DOCTXT}), ' '), TO_CHAR(SYSDATE , 'YYYYMMDD'), 
		  TO_CHAR(SYSDATE , 'HH24MISS') , #{SES_USER_ID}, TO_CHAR(SYSDATE , 'YYYYMMDD'), TO_CHAR(SYSDATE , 'HH24MISS') , #{SES_USER_ID}
		)
				
	</insert>


	<!--RECDI 기반 데이터  조회 -->
	<select id="RECDI_SKUMASTER_MAP" parameterType="hashmap" resultType="DataMap">
        SELECT DISTINCT #{RECVKY} AS RECVKY 
             , #{RECVIT} AS RECVIT
             , NVL(#{PACKID}, ' ') AS PACKID
             , NVL(TRIM(#{MEASKY}), SW.MEASKY) AS MEASKY 
             , NVL(TRIM(#{DUOMKY}), SM.DUOMKY) AS UOMKEY
             , NVL(TRIM(#{QTYSTD}), SM.QTYSTD) AS QTPUOM
             , NVL(TRIM(#{DUOMKY}), SM.DUOMKY) AS DUOMKY
             , NVL(TRIM(#{QTDUOM}), SM.QTDUOM) AS QTDUOM
             , NVL(TRIM(#{OWNRKY}), SW.OWNRKY) AS OWNRKY
             , NVL(#{SKUKEY}, ' ')  AS SKUKEY
             , NVL(TRIM(#{LOTL01}), SM.LOTL01) AS LOTA01
             , NVL(TRIM(#{LOTL02}), SM.LOTL02) AS LOTA02
             , NVL(#{LOTA03}, ' ')  AS LOTA03
             , NVL(TRIM(LOTL04), SM.LOTL04) AS LOTA04
             , NVL(#{LOTA05}, ' ')  AS LOTA05
             , NVL(#{LOTA06}, ' ')  AS LOTA06
             , NVL(TRIM(#{LOTA07}), SM.LOTL07) AS LOTA07
             , NVL(TRIM(#{LOTA08}), SM.LOTL08) AS LOTA08
             , NVL(TRIM(#{LOTA09}), SM.LOTL09) AS LOTA09
             , NVL(TRIM(#{LOTA10}), SM.LOTL10) AS LOTA10
             , NVL(#{LOTA11}, ' ')  AS LOTA11
             , NVL(#{LOTA12}, ' ')  AS LOTA12
             , #{LOTA13}  AS LOTA13
             , NVL(TRIM(#{LOTL14}), SM.LOTL14) AS LOTA14
             , NVL(TRIM(#{LOTL15}), SM.LOTL15) AS LOTA15
             , NVL(TRIM(#{LOTA16}), 0)         AS LOTA16
             , NVL(TRIM(#{LOTA17}), 0)         AS LOTA17
             , NVL(TRIM(#{LOTA18}), 0)         AS LOTA18
             , NVL(TRIM(#{LOTA19}), 0)         AS LOTA19
             , NVL(TRIM(#{LOTA20}), 0)         AS LOTA20
             , (SELECT DISTINCT AREAKY FROM LOCMA WHERE LOCAKY = 'SETLOC' AND LOCMA.WAREKY = SW.WAREKY) AS AREAKY
             , NVL(TRIM(#{DESC01}), SM.DESC01) AS DESC01
             , NVL(TRIM(#{DESC02}), SM.DESC02) AS DESC02
             , NVL(TRIM(#{ASKU01}), SM.ASKU01) AS ASKU01
             , NVL(TRIM(#{ASKU02}), SM.ASKU02) AS ASKU02
             , NVL(TRIM(#{ASKU03}), SM.ASKU03) AS ASKU03
             , NVL(TRIM(#{ASKU04}), SM.ASKU04) AS ASKU04
             , NVL(TRIM(#{ASKU05}), SM.ASKU05) AS ASKU05
             , NVL(TRIM(#{SKUG01}), SM.SKUG01) AS SKUG01
             , NVL(TRIM(#{SKUG02}), SM.SKUG02) AS SKUG02
             , NVL(TRIM(#{SKUG03}), SM.SKUG03) AS SKUG03
             , NVL(TRIM(#{SKUG04}), SM.SKUG04) AS SKUG04
             , NVL(TRIM(#{SKUG05}), SM.SKUG05) AS SKUG05
             , NVL(TRIM(#{GRSWGT}), SM.GRSWGT) AS GRSWGT
             , NVL(TRIM(#{NETWGT}), SM.NETWGT) AS NETWGT
             , NVL(TRIM(#{WGTUNT}), SM.WGTUNT) AS WGTUNT
             , NVL(TRIM(#{LENGTH}), SM.LENGTH) AS LENGTH
             , NVL(TRIM(#{WIDTHW}), SM.WIDTHW) AS WIDTHW
             , NVL(TRIM(#{HEIGHT}), SM.HEIGHT) AS HEIGHT
             , NVL(TRIM(#{CUBICM}), SM.CUBICM) AS CUBICM
             , NVL(TRIM(#{CAPACT}), SM.CAPACT) AS CAPACT
             , NVL(TRIM(#{EANCOD}), SM.EANCOD) AS EANCOD
             , NVL(TRIM(#{GTINCD}), SM.GTINCD) AS GTINCD
          FROM SKUWC SW
               INNER JOIN SKUMA SM ON SM.OWNRKY = SW.OWNRKY AND SW.SKUKEY = SM.SKUKEY
         WHERE SW.OWNRKY = #{OWNRKY} 
           AND SW.WAREKY = #{WAREKY}
           AND SW.SKUKEY = #{SKUKEY}
	</select>

	<!-- RECDI 생성 VALDATION 체크 -->
	<select id="RECDI_VALDATION_MAP" parameterType="hashmap" resultType="DataMap">
		SELECT CASE WHEN TRIM(#{RECVKY}) IS NULL THEN 'VALID_M0560'
					WHEN TRIM(#{RECVIT}) IS NULL THEN 'VALID_M0589'
		            WHEN (SELECT COUNT(1) FROM LOCMA WHERE WAREKY = #{WAREKY} AND LOCAKY = #{LOCAKY}) &lt; 1 THEN 'OUT_M0070'
		            WHEN (SELECT COUNT(1) FROM SKUMA WHERE OWNRKY = #{OWNRKY} AND SKUKEY = #{SKUKEY}) &lt; 1 THEN 'MASTER_M0669'
		            WHEN (SELECT COUNT(1) FROM SKUWC WHERE OWNRKY = #{OWNRKY} AND WAREKY = #{WAREKY} AND SKUKEY = #{SKUKEY}) &lt; 1 THEN 'VALID_M0587'
		            ELSE ''
		        END MSGKEY
		     , 1 as dummy
		  FROM DUAL
	</select>


	
	<!-- RECDI 생성  -->
	<insert id="RECDI_INSERT"  parameterType="hashmap">
		INSERT INTO RECDI
		(
		   RECVKY, RECVIT, STATIT, SAPSTS, SKUKEY, LOTNUM, AREAKY, LOCAKY, SECTID, TRNUID, PACKID, QTYRCV, QTYDIF,
		   QTYUOM, TRUNTY, MEASKY, UOMKEY, QTPUOM, DUOMKY, QTDUOM, INDRCN, CRECVD, RSNCOD, LOTA01, LOTA02, LOTA03,
		   LOTA04, LOTA05, LOTA06, LOTA07, LOTA08, LOTA09, LOTA10, LOTA11, LOTA12, LOTA13, LOTA14, LOTA15, LOTA16,
		   LOTA17, LOTA18, LOTA19, LOTA20, AWMSNO, REFDKY, REFDIT, REFCAT, REFDAT, DESC01, DESC02, ASKU01, ASKU02,
		   ASKU03, ASKU04, ASKU05, EANCOD, GTINCD, SKUG01, SKUG02, SKUG03, SKUG04, SKUG05, GRSWGT, NETWGT, WGTUNT,
		   LENGTH, WIDTHW, HEIGHT, CUBICM, CAPACT, QTYORG, SMANDT, SEBELN, SEBELP, SZMBLNO, SZMIPNO, STRAID, SVBELN,
		   SPOSNR, STKNUM, STPNUM, SWERKS, SLGORT, SDATBG, STDLNR, SSORNU, SSORIT, SMBLNR, SZEILE, SMJAHR, SXBLNR,
		   RCPRSN, CREDAT, CRETIM, CREUSR, LMODAT, LMOTIM, LMOUSR, SBKTXT, UPDCHK
		)
		VALUES
		( #{RECVKY}, LPAD(#{RECVIT}, 6, '0'), NVL(TRIM(#{STATIT}), ' '), NVL(TRIM(#{SAPSTS}), ' '), NVL(TRIM(#{SKUKEY}), ' '), NVL(TRIM(#{LOTNUM}), ' '), NVL(TRIM(#{AREAKY}), ' '), NVL(TRIM(#{LOCAKY}), ' '), NVL(TRIM(#{SECTID}), ' '), NVL(TRIM(#{TRNUID}), ' '), NVL(TRIM(#{PACKID}), ' '), NVL(TRIM(#{QTYRCV}), 0), NVL(TRIM(#{QTYDIF}), 0),
		   NVL(TRIM(#{QTYUOM}), 0), NVL(TRIM(#{TRUNTY}), ' '), NVL(TRIM(#{MEASKY}), ' '), NVL(TRIM(#{UOMKEY}), ' '), NVL(TRIM(#{QTPUOM}), 0), NVL(TRIM(#{DUOMKY}), ' '), NVL(TRIM(#{QTDUOM}), 0), NVL(TRIM(#{INDRCN}), ' '), NVL(TRIM(#{CRECVD}), ' '), NVL(TRIM(#{RSNCOD}), ' '), NVL(TRIM(#{LOTA01}), ' '), NVL(TRIM(#{LOTA02}), ' '), NVL(TRIM(#{LOTA03}), ' '),
		   NVL(TRIM(#{LOTA04}), ' '), NVL(TRIM(#{LOTA05}), ' '), NVL(TRIM(#{LOTA06}), ' '), NVL(TRIM(#{LOTA07}), ' '), NVL(TRIM(#{LOTA08}), ' '), NVL(TRIM(#{LOTA09}), ' '), NVL(TRIM(#{LOTA10}), ' '), NVL(TRIM(#{LOTA11}), ' '), NVL(TRIM(#{LOTA12}), ' '), NVL(TRIM(#{LOTA13}), ' '), NVL(TRIM(#{LOTA14}), ' '), NVL(TRIM(#{LOTA15}), ' '), 
		   NVL(TRIM(#{LOTA16}), 0), NVL(TRIM(#{LOTA17}), 0), NVL(TRIM(#{LOTA18}), 0), NVL(TRIM(#{LOTA19}), 0), NVL(TRIM(#{LOTA20}), 0), NVL(TRIM(#{AWMSNO}), ' '), NVL(TRIM(#{REFDKY}), ' '), NVL(TRIM(#{REFDIT}), ' '), NVL(TRIM(#{REFCAT}), ' '), NVL(TRIM(#{REFDAT}), ' '), NVL(TRIM(#{DESC01}), ' '),NVL(TRIM(#{DESC02}), ' '), NVL(TRIM(#{ASKU01}), ' '),NVL(TRIM(#{ASKU02}), ' '),
		   NVL(TRIM(#{ASKU03}), ' '), NVL(TRIM(#{ASKU04}), ' '), NVL(TRIM(#{ASKU05}), ' '), NVL(TRIM(#{EANCOD}), ' '), NVL(TRIM(#{GTINCD}), ' '), NVL(TRIM(#{SKUG01}), ' '), NVL(TRIM(#{SKUG02}), ' '), NVL(TRIM(#{SKUG03}), ' '), NVL(TRIM(#{SKUG04}), ' '), NVL(TRIM(#{SKUG05}), ' '), NVL(TRIM(#{GRSWGT}), 0), NVL(TRIM(#{NETWGT}), 0), NVL(TRIM(#{WGTUNT}), ' '),
		   NVL(TRIM(#{LENGTH}), 0), NVL(TRIM(#{WIDTHW}), 0), NVL(TRIM(#{HEIGHT}), 0), NVL(TRIM(#{CUBICM}), 0), NVL(TRIM(#{CAPACT}), 0), NVL(TRIM(#{QTYORG}), 0), NVL(TRIM(#{SMANDT}), ' '), NVL(TRIM(#{SEBELN}), ' '), NVL(TRIM(#{SEBELP}), ' '), NVL(TRIM(#{SZMBLNO}), ' '), NVL(TRIM(#{SZMIPNO}), ' '), NVL(TRIM(#{STRAID}), ' '), NVL(TRIM(#{SVBELN}), ' '),
		   NVL(TRIM(#{SPOSNR}), ' '), NVL(TRIM(#{STKNUM}), ' '), NVL(TRIM(#{STPNUM}), ' '), NVL(TRIM(#{SWERKS}), ' '), NVL(TRIM(#{SLGORT}), ' '), NVL(TRIM(#{SDATBG}), ' '), NVL(TRIM(#{STDLNR}), ' '), NVL(TRIM(#{SSORNU}), ' '), NVL(TRIM(#{SSORIT}), ' '), NVL(TRIM(#{SMBLNR}), ' '), NVL(TRIM(#{SZEILE}), ' '), NVL(TRIM(#{SMJAHR}), ' '), NVL(TRIM(#{SXBLNR}), ' '),
		   NVL(TRIM(#{RCPRSN}), ' '), TO_CHAR(SYSDATE, 'YYYYMMDD'), TO_CHAR(SYSDATE, 'HH24MISS'),  #{SES_USER_ID}, TO_CHAR(SYSDATE, 'YYYYMMDD'), TO_CHAR(SYSDATE, 'HH24MISS'),  #{SES_USER_ID}, NVL(#{SBKTXT}, ' '), 0
		)
	</insert>
</mapper>
